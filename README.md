
# Стартовый шаблон Node.js/Express

Стартовый шаблон который я сделал для себя как отправную точку, состоящую из:

**Express** с настроенным редиректом с  http:// на https:// и подключеным сертификатом, разрешёнными кроссдоменными запросами (**cors**), парсером тела и логами (**morgan**).

**Babel**, чтобы иметь возможность использовать современный синтаксис не заботясь о совместимости. Например использовать `import`:

```js
import express from 'express'
```

вместо `require`:

```js
var express = require('express')
```

Используется **babel-node**. С ним преобразование кода в обратно совместимый выполняется на лету в памяти, без сохранения предварительного результата.

**dotenv** для хранения некоторых переменых вне кода.  

Ну и **ESLint** с настроенным стилем "Standard" https://standardjs.com/rules.html.
**ESLint** помогает не только придерживаться единого стиля, но и находит глупые ошибки. Я не вызываю ESLint через npm-скрипт, так как мне удобнее видеть ошибки непосредственно в процессе написания, а **VScode** прекрасно с этим справляется. 



## Перед запуском

| :warning: **Внимание!** Это важно для ваших приватных файлов |  
| --- |

Убедиться что в `.gitignore` добавлена папка `certs`. Создать папку `certs` в корне проекта.  Положить к неё свои `public.crt` (публичный сертификат) и `private.key` (приватный ключ) или временно* создать соответствующие пустые файлы.

<small>* – соответственно работать будет только http:// при запуске в `dev` окружении</small>

Создать файлы `.env.development` и `.env.production` в корне проекта.
Для проверки в `.env.development` добавить любую запись в формате `ИМЯ=значение`, например:
```
SECRET=123
```

## Запуск dev

В терминале запустить соответствующий **npm** скрипт:

```
npm run dev
```

При окружении `dev` не будет происходить автоматического редиректа с http:// на https://, а **nodemon** для удобства разработки будет перезапускать сервер при изменении `.js` и `.json` файлов проекта.

Если в консоле будет:

```
Переменная из .env "123"
Сервер запущен на порту 3000
```

Значит всё работает. `123` это значение из `.env.development`

## Запуск prod

```
npm run prod
```

При окружении `prod` будет происходить автоматический редирект с http:// на https://. Соответсвенно запускать нужно на сервере, а обращаться из под домена. При этом в папке `certs` должны быть действительные для этого домена сертификаты, иначе браузер сообщит об ошибке.

**Dotenv** в этом окружении берёт значение из файла `.env.production`. Применяйте эту возможность, если в `dev` и `prod` окружениях есть различия.